<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Puppet-nginx by arioch</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Puppet-nginx</h1>
        <p></p>

        <p class="view"><a href="https://github.com/arioch/puppet-nginx">View the Project on GitHub <small>arioch/puppet-nginx</small></a></p>


        <ul>
          <li><a href="https://github.com/arioch/puppet-nginx/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/arioch/puppet-nginx/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/arioch/puppet-nginx">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>Puppet nGinX</h1>

<h2>Requirements</h2>

<ul>
<li><a href="https://github.com/ripienaar/puppet-concat">concat module</a></li>
<li>Debian/Ubuntu: Puppetlabs <a href="https://github.com/puppetlabs/puppetlabs-apt">apt module</a>
</li>
</ul><h2>Tested on...</h2>

<ul>
<li>Debian 6 (Squeeze)</li>
</ul><h2>Example usage</h2>

<h3>HTTP reverse proxy</h3>

<pre><code>node /frontend/ {
  class {
    'nginx':;
  }

  Nginx::Proxy {
    ensure =&gt; present,
    enable =&gt; true,
  }

  nginx::proxy {
    'test01.example.com': server_name =&gt; 'test01.example.com', proxy_pass =&gt; 'http://10.0.0.1';
    'test02.example.com': server_name =&gt; 'test02.example.com', proxy_pass =&gt; 'http://10.0.0.2';
  }

}
</code></pre>

<h3>HTTP reverse proxy, with load balancing</h3>

<pre><code>node /frontend/ {
  class {
    'nginx':;
  }

  Nginx::Proxy {
    ensure     =&gt; present,
    enable     =&gt; true,
    proxy_pass =&gt; 'http://backend',
  }

  nginx::proxy {
    'test01.example.com': server_name =&gt; 'test01.example.com', proxy_pass =&gt; 'http://backend';
    'test02.example.com': server_name =&gt; 'test02.example.com', proxy_pass =&gt; 'http://backend';
    'test03.example.com': server_name =&gt; 'test03.example.com', proxy_pass =&gt; 'http://backend';
    'test04.example.com': server_name =&gt; 'test04.example.com', proxy_pass =&gt; 'http://backend';
  }

  nginx::upstream { 'backend':
    ip_hash        =&gt; true,
    upstream_nodes =&gt; [
      '10.0.1.1',
      '10.0.1.2',
      '10.0.1.3',
      '10.0.1.4'
    ];
  }
}
</code></pre>

<h3>Load balancing with ip hashes (sticky connections)</h3>

<p>Sticky connections are useful for applications that rely on cookies or
being served by the same backend node for different reasons.</p>

<p>This is usually the case for PHP applications so it's enabled by default.</p>

<pre><code>nginx::upstream { 'backend':
  ip_hash        =&gt; true,
  upstream_nodes =&gt; [
    '10.0.1.1',
    '10.0.1.2',
    '10.0.1.3',
    '10.0.1.4'
  ];
}
</code></pre>

<h3>Disable access logs</h3>

<pre><code>node /frontend/ {
  class {
    'nginx':;
  }

  nginx::proxy { 'test01.example.com':
    server_name =&gt; 'test01.example.com',
    access_log  =&gt; false,
  }
}
</code></pre>

<h3>Configure proxy cache</h3>

<pre><code>node /frontend/ {
  class { 'nginx':
     proxy_cache           = true,
     proxy_cache_dir       = '/cache',
     proxy_cache_path      = '/cache/static levels=1:2 keys_zone=staticfilecache:60m inactive=90m max_size=500m',
     proxy_connect_timeout = '30',
     proxy_read_timeout    = '120',
     proxy_send_timeout    = '120',
     proxy_temp_path       = '/cache/tmp',
  }
}
</code></pre>

<h3>Mail proxy</h3>

<pre><code>node /frontend/ {
  class {
    'nginx': mail =&gt; true;
  }

  Nginx::Mail {
    ensure         =&gt; present,
    server_name    =&gt; $::fqdn,
    listen_address =&gt; $::ipaddress,
    proxy          =&gt; 'on'
  }

  nginx::mail {
    'imap':     listen_port =&gt; '143', protocol =&gt; 'imap';
    'imaps':    listen_port =&gt; '993', protocol =&gt; 'imap';
    'pop3':     listen_port =&gt; '110', protocol =&gt; 'pop3';
    'pop3s':    listen_port =&gt; '995', protocol =&gt; 'pop3';
    'smtp':     listen_port =&gt; '25',  protocol =&gt; 'smtp';
    'smtp-465': listen_port =&gt; '465', protocol =&gt; 'smtp';
    'smtp-587': listen_port =&gt; '587', protocol =&gt; 'smtp';
  }
}
</code></pre>

<h3>Enable status page</h3>

<pre><code>node /box/ {
  class { 'nginx':
    status_enable =&gt; true,
    status_allow  =&gt; '127.0.0.1',
    status_deny   =&gt; 'all',
  }
</code></pre>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/arioch">arioch</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>